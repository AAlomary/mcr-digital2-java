<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Jammer</title>

    <!-- Bootstrap -->
    <link href="../../../../style/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../style/main.css">
    <link href="https://fonts.googleapis.com/css?family=Comfortaa" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Lato&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <![endif]-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>

        var myName = prompt("Enter your name");

    function sendMessage() {

        var message = {"name": myName, "text": $('.typingMessage').val()};

        $.post("http://localhost:8080/messages", JSON.stringify(message));
    }

//    var refresh;
//
//    window.onload = function() {
//        function screenRefresh() {
//            refresh = setTimeout(sendMessage, 1000);
//        }
//    }

    function timeout() {
        setTimeout(function () {
            // Do Something Here
            document.getElementById("messageDisplay").innerHTML="";
            getMessages();
            // create a recursive loop.
            timeout();
        }, 1000);
    }
</script>
    <script>

        function getMessages(){

            $.getJSON('http://localhost:8080/messages', function(data){
                var messages= [];
                $.each(data, function(key, value){
                    messages.push(value);
                });

                messages.forEach(function(data){
                    $("#messageDisplay").append('<br><p>' + data.name + ': ' + data.text + '</p>');
                    console.log(data);

                })

            });

        }

    </script>
</head>
<body onload="timeout();">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <img class="logo" src="../../../../images/logo.png" alt="">
        </div>
    </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

<div class="chat">
    <div class="contactsBar">
        <div class="contacts">
            <span><a class="contactsText" href="#">Contacts</a></span>
            <span class="glyphicon glyphicon-user placeholder"><a href="#">Joel</a></span>
            <span class="glyphicon glyphicon-user placeholder"><a href="#">Joe</a></span>
            <span class="glyphicon glyphicon-user placeholder"><a href="#">Ahmad</a></span>
        </div>
    </div>

    <div id="messageDisplay">
    </div>

    <div class="message_write">
        <textarea type="text" class="form-control typingMessage" placeholder="Type a message"></textarea>
        <!--<a href="#" class="upload_btn"><i class="fa fa-cloud-upload" aria-hidden="true"></i>Add Files</a>-->
        <button id="btn-success" onclick="sendMessage()" class="btn btn-success">Send</button></div>

</div>
</div>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"/>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../../../../style/js/bootstrap.min.js"></script>
</body>
</html>